<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
  <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡πà‡∏≤‡∏ô LINE</h2>
  <button id="btnLogin">Login ‡∏î‡πâ‡∏ß‡∏¢ LINE</button>
  <div id="form" style="display:none;">
    <p>LINE: <span id="displayName"></span> (<span id="userId"></span>)</p>
    <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï: <input id="licenseNo"></label><br>
    <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: <input id="citizenId"></label><br>
    <label>‡∏ä‡∏∑‡πà‡∏≠‚Äë‡∏™‡∏Å‡∏∏‡∏•: <input id="fullName"></label><br>
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£: <input id="businessType"></label><br>
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï: <input id="approveDate" type="date"></label><br>
    <label>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: <input id="expireDate" type="date"></label><br>
    <button id="btnSubmit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>
  <div id="msg"></div>

  <script>
    const liffId = "2007638338-kaVD7qVa";
    const postUrl = "https://script.google.com/macros/s/AKfycbylhEY1bmq7sC64aZ1hsgjYVMiTVKM-LeXmeNv64KN1RmBQr_sSXnLLJNznVpbVuURo/exec";

    async function init() {
      await liff.init({ liffId });
      if (liff.isLoggedIn()) showForm();
      document.getElementById("btnLogin").addEventListener("click", () => liff.login());
      document.getElementById("btnSubmit").addEventListener("click", sendData);
    }

    async function showForm() {
      const profile = await liff.getProfile();
      document.getElementById("displayName").textContent = profile.displayName;
      document.getElementById("userId").textContent = profile.userId;
      document.getElementById("form").style.display = "block";
      document.getElementById("btnLogin").style.display = "none";
    }

    async function sendData() {
      const o = (id) => document.getElementById(id).value;
      const payload = {
        licenseNo: o("licenseNo"),
        citizenId: o("citizenId"),
        fullName: o("fullName"),
        businessType: o("businessType"),
        approveDate: o("approveDate"),
        expireDate: o("expireDate"),
        userId: document.getElementById("userId").textContent,
        displayName: document.getElementById("displayName").textContent
      };
      const resp = await fetch(postUrl, {
        method: "POST",
        body: JSON.stringify(payload)
      });
      if (resp.ok) {
        document.getElementById("msg").textContent = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üéâ";
      } else {
        document.getElementById("msg").textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    }
    init();
  </script>
</body>
</html>
